language: C

sudo:
  - required

os : 
  - linux 

dist :
  - trusty
#  - xenial


branches :
  except :
    - /^WIP_.*/


compiler:
  - arm-linux-gnueabi-gcc-4.7 
  - arm-linux-gnueabi-gcc-5 
env:
  - DEFCONF=CPS-MC341-ADSCX.novlan_defconfig
  - DEFCONF=CPS-MC341-ADSCX.1lan_defconfig
  - DEFCONF=CPS-MC341-ADSCX.2lan_defconfig
  - DEFCONF=CPS-MC341-DSX.novlan_defconfig
  - DEFCONF=CPS-MC341-DSX.1lan_defconfig
  - DEFCONF=CPS-MC341-DSX.2lan_defconfig
  - DEFCONF=CPS-MC341-AX.novlan_defconfig
  - DEFCONF=CPS-MC341-AX.1lan_defconfig
  - DEFCONF=CPS-MC341-AX.2lan_defconfig
  - DEFCONF=CPS-MC341-DS1X.novlan_defconfig
  - DEFCONF=CPS-MC341-DS1X.1lan_defconfig
  - DEFCONF=CPS-MC341-DS1X.2lan_defconfig        
  - DEFCONF=CPS-MCS341-DSX.novlan_defconfig
  - DEFCONF=CPS-MCS341-DSX.1lan_defconfig
  - DEFCONF=CPS-MCS341-DSX.2lan_defconfig

before_install:
  # apt-get install
  - sudo apt-get install -y gcc-4.7-arm-linux-gnueabi libncurses5-dev binutils-arm-linux-gnueabi u-boot-tools
  - export CROSS_COMPILE=arm-linux-gnueabi-
  - export ARCH=arm
  - sudo ln -s /usr/bin/arm-linux-gnueabi-gcc-4.7 /usr/bin/arm-linux-gnueabi-gcc
  - export CPU_COUNT=`cat /proc/cpuinfo | grep -c processor`
  - export JOB_NUMBER=`expr $CPU_COUNT + 1`

script:
  - ls /usr/bin/arm* 
  # Test 
  - make distclean
  - make defconfig $DEFCONF
  - make prepare
  - make -j$JOB_NUMBER uImage
  - sudo make -j$JOB_NUMBER modules
  - sudo make -j$JOB_NUMBER modules_install
 
after_script:

